
---
title: '스팀커넥트2를 활용한 보팅 및 댓글 작성'
permlink: 2
catalog: true
toc_nav_num: true
toc: true
position: 9999
date: 2018-03-05 17:30:54
categories:
- kr-dev
tags:
- kr-dev
- busy
- jjangjjangman
- kr
- kr-study
thumbnail: 'https://res.cloudinary.com/hpiynhbhq/image/upload/v1520271231/hhh9om3oucnt0xawuanb.png'
sidebar:
    right:
        sticky: true
widgets:
    -
        type: toc
        position: right
---


안녕하세요. 제이콥입니다.

@morning님이 아래 두 강좌를 해주셨는데요.

너무나 설명도 잘해주시고, 예제 코드까지 포함되어있어서

쉽게 스팀커넥트를 연동해볼 수 있었습니다.

<a href="https://busy.org/@morning/2vca1q-2">스팀커넥트2 강좌 :: 개발환경 설정, 스팀 아이디로 로그인하기 버튼 만들기</a>

<a href="https://busy.org/@morning/2-oauth-redirect">스팀커넥트2 강좌 :: OAuth Redirect 후 처리, 로그아웃</a>

이어서 제가 스팀커넥트를 활용해서 보팅과 댓글달기를 했는데요.

두 가지 기능을 구현하기 위한 과정을 간단히 소개해드리겠습니다.

-----

### 스팀파이터에 스팀커넥트 연동!

저도 위 2개의 강좌를 보고 현재 개발중인 서비스에 적용을 해봤습니다.

제 서비스에서 스팀계정이 필요한 기능으로는 아래 두가지입니다.

* 특정 유저에 최신 글에 보팅하기
* 특정 유저에 최신 글에 댓글달기

이를 위해서  필요한 코드는 아래와 같습니다.


<h3>특정 유저의 최신 글 가져오기</h3>
https://v2.steemconnect.com/docs/steemjs#api/get_blog_entries

위의 링크를 들어가면 steemjs에서 제공하는 여러 함수들을 볼 수 있으며, 
직접 테스트도 해볼 수 있습니다.

* author - 보고싶은작가
* entriyId - 몇번글까지에서 검색할 것인가? ( ex - 100으로 한다면, 100부터 99,98 순으로 검색한다.)
* limit - 최신글 몇개를 검색할 것인가?

https://api.steemjs.com/get_blog_entries?account=jacobyu&amp;entryId=9999&amp;limit=5

<pre><code>steem.api.getBlogEntries(author, 9999, 10, function(err, data)
{
    console.log(err, data);
});
</code></pre>

<h3>스팀커넥트 객체 생성</h3>
스팀커넥트로 여러 작업을 하기 위해서는

먼저 스팀커넥트로 로그인을 해야합니다.

이 경우는 모닝님의 강좌를 보시면 됩니다.

<pre><code>var sc2worker= sc2.Initialize({
  app: 'busy',
  callbackURL: 'http://localhost:8000/demo/',
  accessToken: 'access_token',
  scope: ['vote', 'comment']
});</code></pre>

위의 코드를 보면 로그인을 할 경우 위와 같이 
<code>sc2worker</code> 객체를 얻을 수 있습니다.

<h3>보팅하기</h3>

위에서 만든 <code>sc2worker</code> 객체를 이용해서

보팅을 하겠습니다.

<pre><code>sc2worker.vote(user, author, permlink, weight, function (err, res) {
    console.log(err, res)
});</code></pre>

* user - 보팅을 하고자 하는 사람
* author - 보팅을 받는 작가
* permlink - 작가의 permlink
* weight - 몇퍼센트로 보팅할 것인가? 10000이 100퍼센트이다.

ex) https://busy.org/@jacobyu/4loogd
여기서 author는 jacobyu이며, permlink는 4loogd입니다.

<h3> 댓글달기</h3>
위에서 만든 <code>sc2worker</code> 객체를 이용해서

댓글을 달겠습니다.

<pre><code>var permlink = 're-' + authorPermlink+ '-' + Math.floor(Date.now() / 1000);
var jsonMetadata =
{
  "tags": ['steemfighter']
};
sc2worker.comment(author,authorPermlink, user, permlink, '', text, jsonMetadata, function (err, res) {
console.log(err, res)
});</code></pre>

여기서
* author - 댓글을 받을 작가
* authorPermlink - 댓글을 받을 author의 포스팅 permlink
* user - 댓글을 쓸 사람 (steemconnect2로 로그인 한 사람)
* permlink - 댓글의 permlink, 이경우는 위의 코드처럼 자동으로 생성한다.
* "" - 비어 있는 부분은 제목인데, 댓글일 경우 비어놓는다.
* text - 댓글의 내용
* jsonMetadata - 여러 설정, 댓글의 경우 태그만 해도되는 것 같다. 
필자의 경우, 'steemfighter'로 하였다.

<h3>전체 코드</h3>
각각의 부분에 대해 설명을 드렸는데 전체 코드를 보도록 하겠습니다.

저는 한번만 로그인하고, 스팀커넥트 객체를 잘 활용하기 위해

**sc2wrapper**라는 클래스를 만들었고, 소스가 길어 깃헙링크를 올립니다.

https://github.com/passionbull/F.LF/blob/world/world/steem/sc2wrapper.js

그리고 html에서는 아래와 같이 호출합니다.

<pre><code>&lt;!doctype html&gt;
&lt;html lang="en"&gt;
  &lt;head&gt;
    &lt;meta charset="utf-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;SteemConnect2 Tutorial&lt;/h1&gt;
    &lt;a href="#" class="login"&gt;Login with Steem&lt;/a&gt;
    &lt;a href="#" class="logout"&gt;Logout&lt;/a&gt;
    &lt;script src="https://cdn.steemjs.com/lib/latest/steem.min.js"&gt;&lt;/script&gt;
    &lt;script src="jquery.min.js"&gt;&lt;/script&gt;
    &lt;script src="sc2.min.js"&gt;&lt;/script&gt;
    &lt;script src="sc2wrapper.js"&gt;&lt;/script&gt;
    &lt;script&gt;
      var sc2 = new SC2wrapper();
      sc2.getUser();
      sc2.voteLatestPost('jacobyu',1000);
      sc2.commentLatestPost('jacobyu','스팀커텍트를 이용하여 작성하였다!');
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>

### 결과물 1

위와 같이 작성한 테스트 코드를 동작시키면

아래 이미지 처럼, 

제가 작성한 최신글에 보팅과 댓글을 단 것을 확인할 수 있습니다.

![캡처12.PNG](https://res.cloudinary.com/hpiynhbhq/image/upload/v1520271231/hhh9om3oucnt0xawuanb.png)
![캡처11.PNG](https://res.cloudinary.com/hpiynhbhq/image/upload/v1520271225/lc6xjum4inrry7a18iit.png)
![캡처13.PNG](https://res.cloudinary.com/hpiynhbhq/image/upload/v1520271236/hlykigraxykky5kmg7uq.png)

### 결과물 2

아래 사진은 제가 개발중인 프로젝트!

<a href="http://스팀파이터.oa.to">스팀파이터 프로젝트</a>에 

스팀커넥트2를 적용한 것입니다.


![image.png](https://res.cloudinary.com/hpiynhbhq/image/upload/v1520271358/mubhdtum4zuabubmqgle.png)



----

### 결론
스팀커텍트2를 활용하여 보팅과 댓글을 작성해봤습니다.

모닝님이 작성하신 강좌들처럼 쉽게 적어보고 싶었는데

글 작성하는게 어렵네요.

궁금하신게 있다면 댓글 남겨주세요.

감사합니다.

- - -

This page is synchronized from the post: ['스팀커넥트2를 활용한 보팅 및 댓글 작성'](https://steemit.com/@jacobyu/2)
